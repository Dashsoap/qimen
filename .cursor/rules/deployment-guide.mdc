---
description:
globs:
alwaysApply: false
---
# å¥‡é—¨éç”²AIç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°ï¼‰
```bash
# 1. å¯åŠ¨åç«¯
cd backend
node app.js

# 2. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend  
npm run dev

# è®¿é—®: http://localhost:5173
```

### ä¸€é”®å¯åŠ¨è„šæœ¬
```bash
# å‰åç«¯ä¸€ä½“åŒ–å¯åŠ¨
./start-all.sh
```

## ğŸ”§ åç«¯å¯åŠ¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šç›´æ¥å¯åŠ¨ [app.js](mdc:backend/app.js)
```bash
cd backend
node app.js                    # å¼€å‘ç¯å¢ƒ
NODE_ENV=production node app.js  # ç”Ÿäº§ç¯å¢ƒ
```

### æ–¹å¼äºŒï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
```bash
./backend/start.sh              # ç®€å•å¯åŠ¨
./backend/start-server.sh       # å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼
./backend/start-auth-server.sh  # å¸¦ç¯å¢ƒæ£€æŸ¥çš„å¯åŠ¨
```

### æ–¹å¼ä¸‰ï¼šPM2ç®¡ç†ï¼ˆç”Ÿäº§æ¨èï¼‰
```bash
pm2 start backend/app.js --name "qimen-ai"
pm2 logs qimen-ai
pm2 restart qimen-ai
pm2 stop qimen-ai
```

## ğŸŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æœåŠ¡å™¨éƒ¨ç½²ï¼ˆä½¿ç”¨ [deploy.sh](mdc:deploy.sh)ï¼‰
```bash
# ä¸€é”®éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨
./deploy.sh
```

### éƒ¨ç½²ç‰¹ç‚¹
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**: æ‰“åŒ…ã€ä¸Šä¼ ã€é…ç½®ä¸€ä½“åŒ–
- **é›¶åœæœºæ›´æ–°**: å¹³æ»‘é‡å¯æœåŠ¡
- **ç¯å¢ƒé…ç½®**: è‡ªåŠ¨åˆ‡æ¢ç”Ÿäº§é…ç½®
- **å¥åº·æ£€æŸ¥**: éƒ¨ç½²åè‡ªåŠ¨éªŒè¯æœåŠ¡çŠ¶æ€

### ç”Ÿäº§æœåŠ¡å™¨é…ç½®
- **æœåŠ¡å™¨åœ°å€**: 101.201.148.8
- **åç«¯ç«¯å£**: 3001
- **å‰ç«¯è®¿é—®**: é€šè¿‡Nginxåå‘ä»£ç†
- **æ•°æ®åº“**: ç”Ÿäº§ç¯å¢ƒSQLite

## ğŸ“Š æœåŠ¡ç®¡ç†

### æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬æ£€æŸ¥
ssh root@101.201.148.8 '/home/manage-services.sh status'

# æ‰‹åŠ¨æ£€æŸ¥
curl http://localhost:3001/health
curl http://localhost:5173/health
```

### æœåŠ¡æ“ä½œ
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
/home/manage-services.sh start    # å¯åŠ¨
/home/manage-services.sh stop     # åœæ­¢  
/home/manage-services.sh restart  # é‡å¯
/home/manage-services.sh logs     # æŸ¥çœ‹æ—¥å¿—
```

### è¿›ç¨‹ç®¡ç†
```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„æœåŠ¡
ps aux | grep "node.*app.js"
ps aux | grep "vite"

# åœæ­¢æœåŠ¡
pkill -f "node.*app.js"
pkill -f "vite"

# ç«¯å£æ£€æŸ¥
lsof -ti:3001,5173
```

## ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†

### å¼€å‘ç¯å¢ƒ
```bash
cd backend
npx prisma studio          # å¯è§†åŒ–ç®¡ç†ç•Œé¢
npx prisma db push         # æ¨é€schemaå˜æ›´
npx prisma generate        # ç”Ÿæˆå®¢æˆ·ç«¯
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ•°æ®åº“è¿ç§»
NODE_ENV=production npx prisma db push

# å¤‡ä»½æ•°æ®åº“
cp prisma/prod.db backup/prod-$(date +%Y%m%d).db
```

## ğŸ“‹ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡é…ç½®
- **å¼€å‘ç¯å¢ƒ**: [config.env](mdc:backend/config.env)
- **ç”Ÿäº§ç¯å¢ƒ**: [config.prod.env](mdc:backend/config.prod.env)

### å…³é”®é…ç½®é¡¹
```env
NODE_ENV=production
PORT=3001
DATABASE_URL="file:./prisma/prod.db"
JWT_SECRET=your-super-secure-jwt-secret
ARK_API_KEY=your-ai-api-key
```

### å®‰å…¨é…ç½®æ£€æŸ¥
```bash
# æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
cd backend
npm run config:validate  # å¦‚æœæœ‰çš„è¯
```

## ğŸš¨ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **åç«¯æ—¥å¿—**: `backend/app.log`
- **å‰ç«¯æ—¥å¿—**: æµè§ˆå™¨æ§åˆ¶å°
- **Nginxæ—¥å¿—**: `/var/log/nginx/`

### æ—¥å¿—æŸ¥çœ‹
```bash
# å®æ—¶æ—¥å¿—
tail -f backend/app.log

# é”™è¯¯æ—¥å¿—
grep ERROR backend/app.log

# æœåŠ¡å™¨æ—¥å¿—
ssh root@101.201.148.8 'tail -f /home/qimen-backend/app.log'
```

### æ€§èƒ½ç›‘æ§
```bash
# ç³»ç»Ÿèµ„æºä½¿ç”¨
htop
free -h
df -h

# Node.jsè¿›ç¨‹ç›‘æ§
pm2 monit  # å¦‚æœä½¿ç”¨PM2
```

## ğŸ”’ å®‰å…¨é…ç½®

### é˜²ç«å¢™é…ç½®
```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 3001/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

### SSLé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# ä½¿ç”¨Let's Encrypt
sudo certbot --nginx -d yourdomain.com
```

### å¤‡ä»½ç­–ç•¥
```bash
# æ•°æ®åº“å¤‡ä»½
cp backend/prisma/prod.db backup/

# ä»£ç å¤‡ä»½
tar -czf backup/code-$(date +%Y%m%d).tar.gz backend/ frontend/
```

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### æ¥å£è¿é€šæ€§æµ‹è¯•
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3001/health

# APIæµ‹è¯•
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@example.com","password":"123456"}'
```

### å‰ç«¯æµ‹è¯•
```bash
# å‰ç«¯æ„å»ºæµ‹è¯•
cd frontend
npm run build
npm run preview
```

### ç«¯åˆ°ç«¯æµ‹è¯•
å‚è€ƒä¹‹å‰çš„è¿é€šæ€§æµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…å«å®Œæ•´çš„APIæµ‹è¯•ç”¨ä¾‹ã€‚

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### åç«¯å¯åŠ¨å¤±è´¥
1. æ£€æŸ¥ç«¯å£å ç”¨: `lsof -ti:3001`
2. æ£€æŸ¥é…ç½®æ–‡ä»¶: ç¡®ä¿`config.env`å­˜åœ¨
3. æ£€æŸ¥ä¾èµ–: `npm install`
4. æ£€æŸ¥æ•°æ®åº“: `npx prisma db push`

#### å‰ç«¯æ— æ³•è®¿é—®åç«¯
1. æ£€æŸ¥ä»£ç†é…ç½®: [vite.config.js](mdc:frontend/vite.config.js)
2. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ: `curl http://localhost:3001/health`
3. æ£€æŸ¥CORSé…ç½®: æŸ¥çœ‹åç«¯ä¸­é—´ä»¶è®¾ç½®

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤±è´¥
1. æ£€æŸ¥æœåŠ¡å™¨è¿æ¥: `ssh root@101.201.148.8`
2. æ£€æŸ¥ç£ç›˜ç©ºé—´: `df -h`
3. æ£€æŸ¥ç«¯å£å ç”¨: `netstat -tulnp | grep :3001`
4. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—: æ£€æŸ¥deploy.shæ‰§è¡Œè¾“å‡º

### åº”æ€¥å¤„ç†
```bash
# å¿«é€Ÿé‡å¯æ‰€æœ‰æœåŠ¡
./diagnose-server.sh

# å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰å¤‡ä»½ï¼‰
cd backup && tar -xzf latest-backup.tar.gz
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: æŸ¥çœ‹ [README.md](mdc:backend/README.md) å’Œ [AUTH_SYSTEM_README.md](mdc:backend/AUTH_SYSTEM_README.md)
- **æ—¥å¿—**: æŸ¥çœ‹ç›¸åº”çš„æ—¥å¿—æ–‡ä»¶è¿›è¡Œé—®é¢˜è¯Šæ–­
- **ç›‘æ§**: ä½¿ç”¨å¥åº·æ£€æŸ¥æ¥å£ç›‘æ§æœåŠ¡çŠ¶æ€
