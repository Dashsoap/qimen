# ğŸš€ å¥‡é—¨éç”²AIæµå¼åˆ†æé›†æˆæŒ‡å—

## ğŸ“– æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨æ‚¨çš„å¥‡é—¨éç”²å‰ç«¯é¡¹ç›®ä¸­é›†æˆAIæµå¼åˆ†æåŠŸèƒ½ï¼Œæä¾›å®æ—¶ã€æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### âœ¨ ç”¨æˆ·ä½“éªŒä¼˜åŠ¿
- **å®æ—¶å“åº”**: æ— éœ€ç­‰å¾…ï¼ŒAIåˆ†æå†…å®¹å®æ—¶ç”Ÿæˆ
- **å¯è§†åŒ–è¿›åº¦**: æ˜¾ç¤ºåˆ†ææ­¥éª¤å’Œè¿›åº¦æ¡
- **æ‰“å­—æœºæ•ˆæœ**: æ¨¡æ‹ŸçœŸå®çš„AIæ€è€ƒè¿‡ç¨‹
- **ç§»åŠ¨ç«¯é€‚é…**: å®Œç¾æ”¯æŒAndroid/iOSåº”ç”¨

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹
- **Server-Sent Events (SSE)**: æ ‡å‡†çš„æµå¼å“åº”åè®®
- **è‡ªåŠ¨é‡è¿**: ç½‘ç»œå¼‚å¸¸æ—¶è‡ªåŠ¨é‡è¯•
- **å¤šæœåŠ¡å™¨æ”¯æŒ**: æ”¯æŒå¤‡ç”¨æœåŠ¡å™¨åˆ‡æ¢
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºå’Œæ¢å¤æœºåˆ¶

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
å‰ç«¯ç»„ä»¶ (StreamAnalysis.vue)
    â†“ å‘é€åˆ†æè¯·æ±‚
åç«¯æµå¼æ¥å£ (/api/analysis/qimen/stream)
    â†“ è°ƒç”¨AIæ¨¡å‹
è±†åŒ…DeepSeek-R1 API (æµå¼æ¨¡å¼)
    â†“ å®æ—¶è¿”å›å†…å®¹
å‰ç«¯å®æ—¶æ˜¾ç¤º
```

## ğŸ“¦ å·²é›†æˆçš„æ–‡ä»¶

### 1. åç«¯æ¥å£
- `backend/simple-server.js` - æ–°å¢æµå¼åˆ†æç«¯ç‚¹
- `deploy.sh` - éƒ¨ç½²è„šæœ¬

### 2. å‰ç«¯ç»„ä»¶
- `fronend/src/components/StreamAnalysis.vue` - æµå¼åˆ†æç»„ä»¶
- `fronend/src/utils/api.js` - APIé…ç½®æ›´æ–°
- `fronend/src/views/QimenView.vue` - ä¸»é¡µé¢é›†æˆ

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

1. **åœ¨QimenView.vueä¸­å·²é›†æˆ**:
```vue
<!-- æµå¼åˆ†æç»„ä»¶ -->
<StreamAnalysis 
  :panData="panData" 
  :questionValue="questionValue"
  @analysisComplete="handleStreamAnalysisComplete"
/>
```

2. **ç”¨æˆ·æ“ä½œæµç¨‹**:
   - è¾“å…¥å åœé—®é¢˜
   - ç‚¹å‡»"æ’ç›˜"ç”Ÿæˆå¥‡é—¨éç”²æ•°æ®
   - ç‚¹å‡»"ğŸš€ AIæµå¼åˆ†æ"å¼€å§‹å®æ—¶åˆ†æ
   - è§‚çœ‹AIåˆ†æå†…å®¹å®æ—¶ç”Ÿæˆ

### é«˜çº§ç”¨æ³•

#### è‡ªå®šä¹‰æ ·å¼
```vue
<StreamAnalysis 
  :panData="panData" 
  :questionValue="questionValue"
  @analysisComplete="handleStreamAnalysisComplete"
  class="custom-stream-analysis"
/>
```

#### å¤„ç†å®Œæˆäº‹ä»¶
```javascript
function handleStreamAnalysisComplete(result) {
  console.log('æµå¼åˆ†æå®Œæˆ:', result);
  
  // è·å–åˆ†æç»“æœ
  const answer = result.answer;
  const confidence = result.confidence;
  const executionTime = result.executionTime;
  
  // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
  // ...
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æµå¼æ•°æ®æ ¼å¼

#### åˆå§‹åŒ–æ¶ˆæ¯
```json
{
  "type": "init",
  "sessionId": "session-1234567890",
  "timestamp": "2025-06-20T15:19:00.000Z",
  "message": "ğŸ”® æ­£åœ¨å¯åŠ¨å¥‡é—¨éç”²AIåˆ†æ..."
}
```

#### æ­¥éª¤æ¶ˆæ¯
```json
{
  "type": "step",
  "step": 1,
  "action": "è§£ææ’ç›˜ç»“æ„",
  "timestamp": "2025-06-20T15:19:01.000Z",
  "message": "ğŸ“Š å·²è§£æé˜³éä¸€å±€æ ¼å±€ï¼Œç”²å­æ—¶è¾°",
  "paipanInfo": { ... }
}
```

#### å†…å®¹æµ
```json
{
  "type": "content",
  "sessionId": "session-1234567890",
  "timestamp": "2025-06-20T15:19:02.000Z",
  "content": "æ ¹æ®æ‚¨çš„é—®é¢˜",
  "fullContent": "æ ¹æ®æ‚¨çš„é—®é¢˜å’Œå½“å‰æ’ç›˜...",
  "chunkIndex": 1
}
```

#### å®Œæˆæ¶ˆæ¯
```json
{
  "type": "final",
  "sessionId": "session-1234567890",
  "timestamp": "2025-06-20T15:19:30.000Z",
  "analysis": {
    "answer": "å®Œæ•´çš„åˆ†æç»“æœ...",
    "confidence": 0.92,
    "executionTime": 28000,
    "chunkCount": 45,
    "metadata": { ... }
  }
}
```

### ç§»åŠ¨ç«¯é€‚é…

#### Capacitoræ”¯æŒ
```javascript
// è‡ªåŠ¨æ£€æµ‹ç§»åŠ¨ç«¯ç¯å¢ƒ
const isMobile = window.location.protocol === 'file:' || 
                 window.location.protocol === 'capacitor:' || 
                 /Android|iPhone|iPad/i.test(navigator.userAgent);

if (isMobile) {
  // ä½¿ç”¨Fetch Streamæ–¹å¼
  await startFetchStream();
} else {
  // Webç«¯ä½¿ç”¨EventSource
  await startEventSourceStream();
}
```

#### ç½‘ç»œä¼˜åŒ–
```javascript
// å¤šæœåŠ¡å™¨å°è¯•æœºåˆ¶
const servers = [
  'http://101.201.148.8:3001',
  'http://localhost:3001',
  'http://127.0.0.1:3001'
];

for (const server of servers) {
  try {
    const response = await fetch(`${server}/api/analysis/qimen/stream`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestData)
    });
    // è¿æ¥æˆåŠŸï¼Œè·³å‡ºå¾ªç¯
    break;
  } catch (error) {
    // å°è¯•ä¸‹ä¸€ä¸ªæœåŠ¡å™¨
    continue;
  }
}
```

## ğŸ¨ UIç»„ä»¶è¯¦è§£

### æ ¸å¿ƒç»„ä»¶ç»“æ„
```
StreamAnalysis.vue
â”œâ”€â”€ æµå¼åˆ†ææŒ‰é’®åŒºåŸŸ
â”œâ”€â”€ çŠ¶æ€æ­¥éª¤æ˜¾ç¤º
â”œâ”€â”€ å®æ—¶å†…å®¹åŒºåŸŸ
â”‚   â”œâ”€â”€ è¿›åº¦æ¡
â”‚   â”œâ”€â”€ æ‰“å­—æœºæ•ˆæœ
â”‚   â””â”€â”€ å…‰æ ‡é—ªçƒ
â”œâ”€â”€ å®ŒæˆçŠ¶æ€æ˜¾ç¤º
â””â”€â”€ é”™è¯¯å¤„ç†åŒºåŸŸ
```

### æ ·å¼ç‰¹ç‚¹
- **æ¸å˜æŒ‰é’®**: æµå…‰æ•ˆæœçš„æŒ‰é’®åŠ¨ç”»
- **æ¯›ç»ç’ƒèƒŒæ™¯**: ç°ä»£åŒ–çš„åŠé€æ˜è®¾è®¡
- **æ­¥éª¤æŒ‡ç¤ºå™¨**: æ¸…æ™°çš„åˆ†æè¿›åº¦æ˜¾ç¤º
- **å“åº”å¼å¸ƒå±€**: ç§»åŠ¨ç«¯å®Œç¾é€‚é…

## ğŸ“± ç§»åŠ¨ç«¯ä½“éªŒ

### Androidä¼˜åŒ–
- ä½¿ç”¨CapacitoråŸç”Ÿèƒ½åŠ›
- æ”¯æŒåå°åˆ†æ
- ä¼˜åŒ–è§¦æ‘¸äº¤äº’

### iOSä¼˜åŒ–
- Safariå…¼å®¹æ€§å¤„ç†
- ç³»ç»Ÿå­—ä½“é€‚é…
- æµç•…çš„æ»šåŠ¨ä½“éªŒ

## ğŸ” è°ƒè¯•æŒ‡å—

### å¼€å‘æ¨¡å¼è°ƒè¯•
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æµå¼æ•°æ®
console.log('ğŸ“¨ æ”¶åˆ°æµå¼æ•°æ®:', data);
```

### ç§»åŠ¨ç«¯è°ƒè¯•
```bash
# Androidè°ƒè¯•
npx cap run android --livereload

# iOSè°ƒè¯•  
npx cap run ios --livereload
```

### ç½‘ç»œé—®é¢˜æ’æŸ¥
1. æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€: `curl http://101.201.148.8:3001/health`
2. æµ‹è¯•æµå¼æ¥å£: ä½¿ç”¨æµ‹è¯•é¡µé¢ `test-stream.html`
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—: `ssh root@101.201.148.8 'tail -f /home/qimen-backend/server.log'`

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: æµå¼åˆ†æä¸­æ–­æ€ä¹ˆåŠï¼Ÿ
A: ç»„ä»¶å†…ç½®äº†è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œä¼šå°è¯•å¤šä¸ªæœåŠ¡å™¨ã€‚å¦‚æœä»ç„¶å¤±è´¥ï¼Œç‚¹å‡»"é‡è¯•"æŒ‰é’®ã€‚

### Q: ç§»åŠ¨ç«¯æ— æ³•è¿æ¥ï¼Ÿ
A: ç¡®è®¤ç§»åŠ¨ç«¯ç½‘ç»œæƒé™ï¼Œæ£€æŸ¥æ˜¯å¦å¼€å¯äº†HTTPæ˜æ–‡ä¼ è¾“æƒé™ï¼ˆAndroidï¼‰ã€‚

### Q: åˆ†æé€Ÿåº¦æ…¢ï¼Ÿ
A: æµå¼åˆ†æä¼šå®æ—¶æ˜¾ç¤ºå†…å®¹ï¼Œæ•´ä½“æ„ŸçŸ¥é€Ÿåº¦æ›´å¿«ã€‚å®é™…AIåˆ†ææ—¶é—´å–å†³äºé—®é¢˜å¤æ‚åº¦ã€‚

### Q: å¦‚ä½•è‡ªå®šä¹‰UIï¼Ÿ
A: ä¿®æ”¹`StreamAnalysis.vue`ä¸­çš„æ ·å¼éƒ¨åˆ†ï¼Œæˆ–é€šè¿‡CSSè¦†ç›–é»˜è®¤æ ·å¼ã€‚

## ğŸ‰ å®Œæˆï¼

æ‚¨çš„å¥‡é—¨éç”²åº”ç”¨ç°åœ¨å·²ç»é›†æˆäº†å…ˆè¿›çš„AIæµå¼åˆ†æåŠŸèƒ½ï¼

### ä¸‹ä¸€æ­¥
1. æµ‹è¯•å„ç§é—®é¢˜çš„åˆ†ææ•ˆæœ
2. æ ¹æ®ç”¨æˆ·åé¦ˆä¼˜åŒ–UIä½“éªŒ
3. è€ƒè™‘æ·»åŠ è¯­éŸ³æ’­æŠ¥åŠŸèƒ½
4. é›†æˆæ›´å¤šAIåˆ†ææ¨¡å¼

### æŠ€æœ¯æ”¯æŒ
å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- æœåŠ¡å™¨æ—¥å¿—: `ssh root@101.201.148.8 'tail -f /home/qimen-backend/server.log'`
- å‰ç«¯æ§åˆ¶å°: æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- æµ‹è¯•é¡µé¢: `test-stream.html`

---

**ğŸ”® æ„¿AIä¸ºæ‚¨çš„å¥‡é—¨éç”²å¢æ·»æ™ºæ…§ä¹‹å…‰ï¼** 